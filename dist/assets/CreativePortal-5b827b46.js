import{c as $,u as V,r,d as O,j as e,D as W,C as m,g as M,h as k,e as F,i as w,K as X,B as v,L as I,G as ee,a as J,I as se,Z as ae,J as te,F as re,O as le,N as ne,Q as G,V as ie,W as R,X as ce}from"./index-1d1ce9ed.js";import{e as Q,a as Y,B as u,f as C,N as oe}from"./NotificationsBell-9e56db9c.js";import{a as de,b as xe}from"./assignments-323b621c.js";import{F as me}from"./frown-134a8156.js";import{C as U}from"./calendar-fda30b35.js";import{u as he,T as ue,a as je,b as E,c as L,g as K,d as fe,e as pe}from"./comments-599b21d1.js";import{L as B}from"./label-eae76c9c.js";import{T as ge}from"./textarea-2b7ed22c.js";import{L as Ne}from"./loader-2-07cb1bf6.js";import{U as be}from"./upload-646d5a93.js";import{A as ve}from"./arrow-left-1cdc855b.js";import{C as ye}from"./check-circle-c06d78bc.js";const we=$("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]),Ce=()=>{const{user:c}=V(),[x,_]=r.useState([]),[g,l]=r.useState(!0),[n,S]=r.useState(null),{i18n:j}=O(),N=j.language==="es"?Q:Y;return r.useEffect(()=>{(async()=>{if(!c){l(!1);return}try{const a=await de(c.id);_(a)}catch(a){console.error("Error fetching assignments:",a),S(a.message)}finally{l(!1)}})()},[c]),g?e.jsx(W,{}):n?e.jsxs("div",{className:"text-center text-red-400 bg-red-900/20 p-6 rounded-lg",children:[e.jsx(me,{className:"w-12 h-12 mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-semibold",children:n})]}):x.length===0?e.jsxs(m,{className:"bg-card/40 border-border/40 text-center p-8",children:[e.jsx(M,{className:"text-2xl font-semibold text-foreground mb-4",children:"No tienes tareas asignadas"}),e.jsx(k,{className:"text-foreground/80",children:"Cuando un productor te asigne a un proyecto, aparecerá aquí."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-foreground mb-2",children:"Mis Tareas"}),e.jsx("p",{className:"text-foreground/70",children:"Proyectos en los que estás trabajando"})]}),e.jsx("div",{className:"grid gap-6 lg:grid-cols-2",children:x.map(o=>{var b,A;const a=o.projects,d=(b=a==null?void 0:a.project_briefs)==null?void 0:b[0],i=(A=a==null?void 0:a.project_milestones)==null?void 0:A.filter(h=>h.status==="pending").sort((h,D)=>new Date(h.due_at)-new Date(D.due_at))[0];return e.jsxs(m,{className:"bg-card/40 border-border/40 hover:border-primary/50 transition-colors",children:[e.jsx(F,{children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx(M,{className:"text-xl font-semibold text-foreground mb-2",children:(a==null?void 0:a.title)||"Proyecto sin título"}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx(u,{variant:(a==null?void 0:a.status)==="production"?"default":"secondary",children:(a==null?void 0:a.status)||"draft"}),e.jsx(u,{variant:"outline",children:o.role}),o.stage&&e.jsx(u,{variant:"outline",children:o.stage})]})]})})}),e.jsxs(w,{className:"space-y-4",children:[(d==null?void 0:d.objective)&&e.jsx("div",{className:"text-foreground/80",children:e.jsx("p",{className:"text-sm line-clamp-2",children:d.objective})}),i&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-foreground/70",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsx("span",{children:"Próximo hito:"}),e.jsx("span",{className:"font-medium",children:i.name}),i.due_at&&e.jsxs("span",{className:"text-foreground/50",children:["(",C(new Date(i.due_at),"dd MMM",{locale:N}),")"]})]}),(d==null?void 0:d.deadline_date)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-foreground/70",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{children:"Deadline:"}),e.jsx("span",{className:"font-medium",children:C(new Date(d.deadline_date),"dd MMM yyyy",{locale:N})})]}),e.jsx(v,{asChild:!0,className:"w-full mt-4",children:e.jsxs(I,{to:`/creative/projects/${a==null?void 0:a.id}`,children:["Ver proyecto ",e.jsx(ee,{className:"w-4 h-4 ml-2"})]})})]})]},o.id)})})]})},Me=({projectId:c,onUploadSuccess:x})=>{const{user:_}=V(),{toast:g}=J(),[l,n]=r.useState(null),[S,j]=r.useState(""),[N,o]=r.useState("draft"),[a,d]=r.useState(!1),[i,b]=r.useState(!1),A=t=>{const f=t.target.files[0];if(f){if(f.size>100*1024*1024){g({variant:"destructive",title:"Archivo muy grande",description:"El archivo no puede ser mayor a 100MB"});return}n(f)}},h=async()=>{if(!l){g({variant:"destructive",title:"Selecciona un archivo",description:"Debes seleccionar un archivo para subir"});return}b(!0);try{await he(c,_.id,l,{type:N,notes:S,is_final:a}),g({title:"✅ Asset subido exitosamente",description:"El archivo se ha subido correctamente"}),n(null),j(""),o("draft"),d(!1);const t=document.getElementById("asset-file");t&&(t.value=""),x&&x()}catch(t){console.error("Error uploading asset:",t),g({variant:"destructive",title:"Error al subir",description:t.message||"No se pudo subir el archivo"})}finally{b(!1)}},D=t=>{if(t===0)return"0 Bytes";const f=1024,H=["Bytes","KB","MB","GB"],P=Math.floor(Math.log(t)/Math.log(f));return Math.round(t/Math.pow(f,P)*100)/100+" "+H[P]};return e.jsxs(m,{className:"bg-card/40 border-border/40",children:[e.jsx(F,{children:e.jsx(M,{className:"text-xl font-semibold text-foreground",children:"Subir Asset"})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"asset-file",children:"Archivo"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(se,{id:"asset-file",type:"file",onChange:A,disabled:i,className:"flex-1"}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-foreground/70",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{children:l.name}),e.jsxs("span",{className:"text-foreground/50",children:["(",D(l.size),")"]}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>n(null),disabled:i,children:e.jsx(ae,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"asset-type",children:"Tipo"}),e.jsxs("select",{id:"asset-type",value:N,onChange:t=>o(t.target.value),disabled:i,className:"w-full px-3 py-2 bg-background border border-border rounded-md text-foreground",children:[e.jsx("option",{value:"draft",children:"Borrador"}),e.jsx("option",{value:"review",children:"En revisión"}),e.jsx("option",{value:"final",children:"Final"}),e.jsx("option",{value:"reference",children:"Referencia"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"asset-notes",children:"Notas (opcional)"}),e.jsx(ge,{id:"asset-notes",value:S,onChange:t=>j(t.target.value),disabled:i,placeholder:"Agrega notas sobre esta versión...",rows:3})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is-final",checked:a,onChange:t=>d(t.target.checked),disabled:i,className:"w-4 h-4"}),e.jsx(B,{htmlFor:"is-final",className:"cursor-pointer",children:"Marcar como versión final"})]}),e.jsx(v,{onClick:h,disabled:!l||i,className:"w-full",children:i?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-4 h-4 mr-2 animate-spin"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Subir Asset"]})})]})]})},_e=()=>{var q;const{projectId:c}=te(),{user:x}=V(),{toast:_}=J(),{i18n:g}=O(),l=g.language==="es"?Q:Y,[n,S]=r.useState(null),[j,N]=r.useState([]),[o,a]=r.useState([]),[d,i]=r.useState(!0),[b,A]=r.useState(null),[h,D]=r.useState(""),[t,f]=r.useState(!1);r.useEffect(()=>{(async()=>{if(!(!x||!c))try{i(!0);const y=await xe(c,x.id);S(y);const[T,Z]=await Promise.all([K(c),fe(c,x.id)]);N(T),a(Z)}catch(y){console.error("Error fetching project details:",y),A(y.message)}finally{i(!1)}})()},[x,c]);const H=async()=>{try{const s=await K(c);N(s)}catch(s){console.error("Error reloading assets:",s)}},P=async()=>{if(h.trim()){f(!0);try{const s=await pe(c,x.id,h,"client");a([...o,s]),D(""),_({title:"Comentario publicado",description:"Tu comentario se ha publicado correctamente"})}catch(s){console.error("Error creating comment:",s),_({variant:"destructive",title:"Error",description:s.message||"No se pudo publicar el comentario"})}finally{f(!1)}}};if(d)return e.jsx(W,{});if(b||!n)return e.jsxs("div",{className:"text-center text-red-400 bg-red-900/20 p-6 rounded-lg",children:[e.jsx("p",{className:"text-xl font-semibold",children:b||"Proyecto no encontrado"}),e.jsx(v,{asChild:!0,className:"mt-4",children:e.jsx(I,{to:"/creative",children:"Volver a mis tareas"})})]});const p=(q=n.project_briefs)==null?void 0:q[0],z=n.project_milestones||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(v,{asChild:!0,variant:"outline",children:e.jsxs(I,{to:"/creative",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:n.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(u,{variant:n.status==="production"?"default":"secondary",children:n.status}),n.assignment&&e.jsxs(u,{variant:"outline",children:["Rol: ",n.assignment.role]})]})]})]}),e.jsxs(ue,{defaultValue:"overview",className:"space-y-4",children:[e.jsxs(je,{children:[e.jsx(E,{value:"overview",children:"Resumen"}),e.jsx(E,{value:"assets",children:"Assets"}),e.jsx(E,{value:"milestones",children:"Hitos"}),e.jsx(E,{value:"comments",children:"Comentarios"})]}),e.jsxs(L,{value:"overview",className:"space-y-4",children:[p&&e.jsxs(m,{className:"bg-card/40 border-border/40",children:[e.jsx(F,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Brief del Proyecto"]})}),e.jsxs(w,{className:"space-y-4",children:[p.objective&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground mb-2",children:"Objetivo"}),e.jsx("p",{className:"text-foreground/80",children:p.objective})]}),p.audience&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground mb-2",children:"Audiencia"}),e.jsx("p",{className:"text-foreground/80",children:p.audience})]}),p.key_messages&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground mb-2",children:"Mensajes Clave"}),e.jsx("p",{className:"text-foreground/80",children:p.key_messages})]}),p.deadline_date&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-foreground/70"}),e.jsxs("span",{className:"text-foreground/80",children:["Deadline: ",C(new Date(p.deadline_date),"dd MMM yyyy",{locale:l})]})]})]})]}),e.jsx(Me,{projectId:c,onUploadSuccess:H})]}),e.jsxs(L,{value:"assets",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Assets del Proyecto"}),e.jsxs(u,{variant:"outline",children:[j.length," versión",j.length!==1?"es":""]})]}),j.length===0?e.jsxs(m,{className:"bg-card/40 border-border/40 text-center p-8",children:[e.jsx(le,{className:"w-12 h-12 mx-auto mb-4 text-foreground/50"}),e.jsx(k,{children:"No hay assets subidos aún"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:j.map(s=>e.jsxs(m,{className:"bg-card/40 border-border/40",children:[e.jsxs(F,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(M,{className:"text-lg",children:["Versión ",s.version,s.is_final&&e.jsx(u,{variant:"default",className:"ml-2",children:"Final"})]}),e.jsx(u,{variant:"outline",children:s.type})]}),s.notes&&e.jsx(k,{className:"mt-2",children:s.notes})]}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm text-foreground/70",children:C(new Date(s.created_at),"dd MMM yyyy HH:mm",{locale:l})}),s.profiles&&e.jsxs("div",{className:"text-sm text-foreground/70",children:["Por: ",s.profiles.full_name]}),e.jsx(v,{asChild:!0,variant:"outline",className:"w-full mt-4",children:e.jsxs("a",{href:s.file_url,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Descargar"]})})]})})]},s.id))})]}),e.jsxs(L,{value:"milestones",className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Hitos del Proyecto"}),z.length===0?e.jsxs(m,{className:"bg-card/40 border-border/40 text-center p-8",children:[e.jsx(X,{className:"w-12 h-12 mx-auto mb-4 text-foreground/50"}),e.jsx(k,{children:"No hay hitos definidos aún"})]}):e.jsx("div",{className:"space-y-4",children:z.map(s=>e.jsxs(m,{className:"bg-card/40 border-border/40",children:[e.jsxs(F,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{children:s.name}),e.jsx(u,{variant:s.status==="approved"?"default":s.status==="in_progress"?"secondary":"outline",children:s.status})]}),s.description&&e.jsx(k,{className:"mt-2",children:s.description})]}),e.jsxs(w,{children:[s.due_at&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-foreground/70",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsxs("span",{children:["Vence: ",C(new Date(s.due_at),"dd MMM yyyy",{locale:l})]})]}),s.status==="approved"&&s.approved_at&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-400 mt-2",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:["Aprobado: ",C(new Date(s.approved_at),"dd MMM yyyy",{locale:l})]})]})]})]},s.id))})]}),e.jsxs(L,{value:"comments",className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Comentarios"}),e.jsxs(m,{className:"bg-card/40 border-border/40",children:[e.jsx(F,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Nuevo Comentario"]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsx("textarea",{value:h,onChange:s=>D(s.target.value),placeholder:"Escribe un comentario...",className:"w-full min-h-[100px] px-3 py-2 bg-background border border-border rounded-md text-foreground",disabled:t}),e.jsx(v,{onClick:P,disabled:!h.trim()||t,children:t?"Publicando...":"Publicar Comentario"})]})]}),e.jsx("div",{className:"space-y-4",children:o.length===0?e.jsxs(m,{className:"bg-card/40 border-border/40 text-center p-8",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-4 text-foreground/50"}),e.jsx(k,{children:"No hay comentarios aún"})]}):o.map(s=>{var y,T;return e.jsx(m,{className:"bg-card/40 border-border/40",children:e.jsx(w,{className:"pt-6",children:e.jsx("div",{className:"flex items-start gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold text-foreground",children:((y=s.profiles)==null?void 0:y.full_name)||"Usuario"}),e.jsx(u,{variant:"outline",className:"text-xs",children:((T=s.profiles)==null?void 0:T.profile_type)||"user"}),e.jsx("span",{className:"text-sm text-foreground/50",children:C(new Date(s.created_at),"dd MMM yyyy HH:mm",{locale:l})})]}),e.jsx("p",{className:"text-foreground/80",children:s.message})]})})})},s.id)})})]})]})]})},Re=()=>e.jsxs("div",{className:"min-h-screen bg-[#05070D] text-white",children:[e.jsx("div",{className:"border-b border-white/10 bg-black/30 backdrop-blur",children:e.jsxs("div",{className:"mx-auto flex max-w-7xl items-center justify-between px-6 py-5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-white/50",children:"ILYR Creative Workspace"}),e.jsx("h1",{className:"text-2xl font-semibold text-white",children:"Tus misiones y entregables"})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(v,{asChild:!0,variant:"outline",className:"border-white/20 text-white hover:bg-white/10",children:e.jsx(I,{to:".",children:"Mis tareas"})}),e.jsx(oe,{})]})]})}),e.jsx("main",{className:"mx-auto min-h-[calc(100vh-120px)] w-full max-w-6xl px-6 py-10",children:e.jsxs(ie,{children:[e.jsx(R,{index:!0,element:e.jsx(Ce,{})}),e.jsx(R,{path:"projects/:projectId",element:e.jsx(_e,{})}),e.jsx(R,{path:"*",element:e.jsx(ce,{to:".",replace:!0})})]})})]});export{Re as default};
