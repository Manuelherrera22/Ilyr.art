import{c as ee,r as m,j as e,D as G,C as N,i as b,B as f,e as D,g as M,K as se,Y as ae,s as te,a as $,o as F,h as re,U as Y,I as ie,Z as ne,$ as ce,Q as le,L as P,V as oe,W as I,X as de}from"./index-1d1ce9ed.js";import{r as g,t as x,a as xe,g as z,b as me,e as ue,B,N as he}from"./NotificationsBell-9e56db9c.js";import{a as fe,S as R,u as ge}from"./projects-824941ba.js";import{C as K}from"./calendar-fda30b35.js";import{g as je,c as pe,r as ve}from"./assignments-323b621c.js";import{D as Ne,a as be,b as we,c as ye,d as De,e as Me}from"./dialog-fca99ede.js";import{L}from"./label-eae76c9c.js";import{L as Se}from"./loader-2-07cb1bf6.js";const Ce=ee("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);function O(s,a){g(2,arguments);var t=x(s),n=x(a),l=t.getTime()-n.getTime();return l<0?-1:l>0?1:l}function Ae(s,a){g(2,arguments);var t=x(s),n=x(a),l=t.getFullYear()-n.getFullYear(),o=t.getMonth()-n.getMonth();return l*12+o}function _e(s,a){return g(2,arguments),x(s).getTime()-x(a).getTime()}var H={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(a){return a<0?Math.ceil(a):Math.floor(a)}},Te="trunc";function ke(s){return s?H[s]:H[Te]}function Ee(s){g(1,arguments);var a=x(s);return a.setHours(23,59,59,999),a}function Ie(s){g(1,arguments);var a=x(s),t=a.getMonth();return a.setFullYear(a.getFullYear(),t+1,0),a.setHours(23,59,59,999),a}function Oe(s){g(1,arguments);var a=x(s);return Ee(a).getTime()===Ie(a).getTime()}function Be(s,a){g(2,arguments);var t=x(s),n=x(a),l=O(t,n),o=Math.abs(Ae(t,n)),i;if(o<1)i=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-l*o);var u=O(t,n)===-l;Oe(x(s))&&o===1&&O(s,n)===1&&(u=!1),i=l*(o-Number(u))}return i===0?0:i}function Pe(s,a,t){g(2,arguments);var n=_e(s,a)/1e3;return ke(t==null?void 0:t.roundingMethod)(n)}function Q(s,a){if(s==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&(s[t]=a[t]);return s}function Re(s){return Q({},s)}var V=1440,Le=2520,U=43200,Ue=86400;function qe(s,a,t){var n,l;g(2,arguments);var o=me(),i=(n=(l=t==null?void 0:t.locale)!==null&&l!==void 0?l:o.locale)!==null&&n!==void 0?n:xe;if(!i.formatDistance)throw new RangeError("locale must contain formatDistance property");var u=O(s,a);if(isNaN(u))throw new RangeError("Invalid time value");var c=Q(Re(t),{addSuffix:!!(t!=null&&t.addSuffix),comparison:u}),h,w;u>0?(h=x(a),w=x(s)):(h=x(s),w=x(a));var y=Pe(w,h),_=(z(w)-z(h))/1e3,d=Math.round((y-_)/60),j;if(d<2)return t!=null&&t.includeSeconds?y<5?i.formatDistance("lessThanXSeconds",5,c):y<10?i.formatDistance("lessThanXSeconds",10,c):y<20?i.formatDistance("lessThanXSeconds",20,c):y<40?i.formatDistance("halfAMinute",0,c):y<60?i.formatDistance("lessThanXMinutes",1,c):i.formatDistance("xMinutes",1,c):d===0?i.formatDistance("lessThanXMinutes",1,c):i.formatDistance("xMinutes",d,c);if(d<45)return i.formatDistance("xMinutes",d,c);if(d<90)return i.formatDistance("aboutXHours",1,c);if(d<V){var T=Math.round(d/60);return i.formatDistance("aboutXHours",T,c)}else{if(d<Le)return i.formatDistance("xDays",1,c);if(d<U){var k=Math.round(d/V);return i.formatDistance("xDays",k,c)}else if(d<Ue)return j=Math.round(d/U),i.formatDistance("aboutXMonths",j,c)}if(j=Be(w,h),j<12){var E=Math.round(d/U);return i.formatDistance("xMonths",E,c)}else{var S=j%12,C=Math.floor(j/12);return S<3?i.formatDistance("aboutXYears",C,c):S<9?i.formatDistance("overXYears",C,c):i.formatDistance("almostXYears",C+1,c)}}function Xe(s,a){return g(1,arguments),qe(s,Date.now(),a)}const Fe=({brief:s,onSelect:a})=>{var n;const t=Xe(new Date(s.created_at),{addSuffix:!0,locale:ue});return e.jsxs(N,{className:"border border-white/10 bg-[#121420]/80 transition hover:border-accent/60",children:[e.jsx(D,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{className:"text-xl text-white",children:((n=s.project)==null?void 0:n.title)||"Proyecto sin título"}),e.jsx("p",{className:"text-xs uppercase tracking-widest text-white/40 mt-1",children:s.id.slice(0,8)})]}),e.jsx(B,{variant:"outline",className:"border-accent/40 text-accent",children:s.status})]})}),e.jsxs(b,{className:"space-y-4 text-white/80",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-white/90",children:"Objetivo"}),e.jsx("p",{className:"text-sm",children:s.objective||"Sin especificar"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-white/90",children:"Audiencia"}),e.jsx("p",{className:"text-sm line-clamp-2",children:s.audience||"No definida"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-white/50",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-4 w-4"}),t]}),s.deadline_date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"h-4 w-4"}),"Deadline: ",s.deadline_date]})]}),e.jsxs(f,{type:"button",variant:"ghost",className:"w-full justify-between text-accent hover:text-accent/80 hover:bg-accent/10",onClick:()=>a(s),children:["Ver detalle",e.jsx(ae,{className:"h-4 w-4"})]})]})]})},Ye=()=>e.jsx(N,{className:"border border-white/10 bg-[#121420]/60",children:e.jsxs(b,{className:"py-16 text-center text-white/70",children:[e.jsx("p",{className:"text-lg font-semibold",children:"No hay briefs pendientes"}),e.jsx("p",{className:"mt-2 text-sm text-white/50",children:"Cuando un cliente envíe un brief, aparecerá aquí para que lo evalúes y armes la propuesta."})]})}),ze=({onSelectBrief:s})=>{const[a,t]=m.useState([]),[n,l]=m.useState(!0),[o,i]=m.useState(null),u=async()=>{l(!0);const{data:c,error:h}=await fe();h?i(h.message):(t(c||[]),i(null)),l(!1)};return m.useEffect(()=>{u()},[]),n?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(G,{})}):o?e.jsx(N,{className:"border border-red-500/40 bg-red-500/10",children:e.jsxs(b,{className:"py-12 text-center text-red-200",children:[e.jsx("p",{className:"font-semibold",children:"No pudimos cargar los briefs."}),e.jsx("p",{className:"mt-2 text-sm opacity-80",children:o}),e.jsx(f,{className:"mt-4",variant:"outline",onClick:u,children:"Intentar de nuevo"})]})}):a.length===0?e.jsx(Ye,{}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:a.map(c=>e.jsx(Fe,{brief:c,onSelect:s},c.id))})},He=async()=>{const{data:s,error:a}=await te.from("profiles").select(`
      id,
      full_name,
      profile_type,
      created_at
    `).eq("profile_type","creative").order("full_name",{ascending:!0});if(a)throw console.error("Error fetching creative users:",a),new Error(a.message);return s||[]},Ve=({projectId:s,projectTitle:a})=>{const{toast:t}=$(),[n,l]=m.useState([]),[o,i]=m.useState([]),[u,c]=m.useState(!0),[h,w]=m.useState(!1),[y,_]=m.useState(!1),[d,j]=m.useState(""),[T,k]=m.useState("creative"),[E,S]=m.useState("");m.useEffect(()=>{s&&(async()=>{try{c(!0);const[p,v]=await Promise.all([je(s),He()]);l(p),i(v)}catch(p){console.error("Error fetching data:",p),t({variant:"destructive",title:"Error",description:p.message||"No se pudieron cargar las asignaciones"})}finally{c(!1)}})()},[s,t]);const C=async()=>{if(!d){t({variant:"destructive",title:"Selecciona un usuario",description:"Debes seleccionar un creativo para asignar"});return}w(!0);try{const r=await pe(s,d,T,E||null);l([...n,r]),_(!1),j(""),k("creative"),S(""),t({title:"✅ Asignación creada",description:"El creativo ha sido asignado al proyecto"})}catch(r){console.error("Error assigning user:",r),t({variant:"destructive",title:"Error",description:r.message||"No se pudo crear la asignación"})}finally{w(!1)}},Z=async(r,p)=>{if(confirm(`¿Estás seguro de que quieres remover a ${p} de este proyecto?`))try{await ve(r),l(n.filter(v=>v.id!==r)),t({title:"✅ Asignación removida",description:"El usuario ha sido removido del proyecto"})}catch(v){console.error("Error removing assignment:",v),t({variant:"destructive",title:"Error",description:v.message||"No se pudo remover la asignación"})}},J=n.filter(r=>r.status==="active").map(r=>r.user_id),q=o.filter(r=>!J.includes(r.id));if(u)return e.jsx(G,{});const X=n.filter(r=>r.status==="active");return e.jsxs(N,{className:"bg-card/40 border-border/40",children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"Asignaciones del Equipo"]}),e.jsx(re,{className:"mt-2",children:"Gestiona quién trabaja en este proyecto"})]}),e.jsxs(Ne,{open:y,onOpenChange:_,children:[e.jsx(be,{asChild:!0,children:e.jsxs(f,{size:"sm",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Asignar"]})}),e.jsxs(we,{className:"bg-background border-border",children:[e.jsxs(ye,{children:[e.jsx(De,{children:"Asignar Creativo al Proyecto"}),e.jsxs(Me,{children:['Selecciona un creativo para asignarlo a "',a,'"']})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"user-select",children:"Creativo"}),q.length===0?e.jsx("p",{className:"text-sm text-foreground/70",children:"No hay creativos disponibles. Todos ya están asignados o no hay creativos en el sistema."}):e.jsxs("select",{id:"user-select",value:d,onChange:r=>j(r.target.value),className:"w-full px-3 py-2 bg-background border border-border rounded-md text-foreground",children:[e.jsx("option",{value:"",children:"Selecciona un creativo..."}),q.map(r=>e.jsx("option",{value:r.id,children:r.full_name||r.id},r.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"role-select",children:"Rol"}),e.jsxs("select",{id:"role-select",value:T,onChange:r=>k(r.target.value),className:"w-full px-3 py-2 bg-background border border-border rounded-md text-foreground",children:[e.jsx("option",{value:"creative",children:"Creativo"}),e.jsx("option",{value:"vfx",children:"VFX Artist"}),e.jsx("option",{value:"cgi",children:"CGI Artist"}),e.jsx("option",{value:"post",children:"Post-Producción"}),e.jsx("option",{value:"motion",children:"Motion Graphics"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"stage-input",children:"Etapa (opcional)"}),e.jsx(ie,{id:"stage-input",value:E,onChange:r=>S(r.target.value),placeholder:"Ej: Pre-producción, Producción, Post"})]}),e.jsx(f,{onClick:C,disabled:!d||h,className:"w-full",children:h?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4 mr-2 animate-spin"}),"Asignando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Asignar"]})})]})]})]})]})}),e.jsx(b,{children:X.length===0?e.jsxs("div",{className:"text-center py-8 text-foreground/70",children:[e.jsx(F,{className:"w-12 h-12 mx-auto mb-4 text-foreground/30"}),e.jsx("p",{children:"No hay asignaciones activas"}),e.jsx("p",{className:"text-sm mt-2",children:"Asigna creativos para comenzar a trabajar en este proyecto"})]}):e.jsx("div",{className:"space-y-3",children:X.map(r=>{var p;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/50 rounded-lg border border-border/40",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:((p=r.profiles)==null?void 0:p.full_name)||"Usuario sin nombre"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(B,{variant:"outline",className:"text-xs",children:r.role}),r.stage&&e.jsx(B,{variant:"secondary",className:"text-xs",children:r.stage})]})]})}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>{var v;return Z(r.id,((v=r.profiles)==null?void 0:v.full_name)||"Usuario")},className:"text-destructive hover:text-destructive",children:e.jsx(ne,{className:"w-4 h-4"})})]},r.id)})})})]})},A=({label:s,value:a})=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-widest text-white/40",children:s}),e.jsx("p",{className:"mt-2 text-sm text-white/90 whitespace-pre-line",children:a||"—"})]}),We=({brief:s,onClose:a,onRefresh:t})=>{var o,i;const{toast:n}=$(),l=async u=>{const{error:c}=await ge(s.id,u);if(c){n({variant:"destructive",title:"No se pudo actualizar el brief",description:c.message});return}n({title:u==="in_review"?"Brief marcado como en revisión":"Brief aceptado",description:"El cliente será notificado del cambio de estado.",className:"bg-green-500 text-white"}),t==null||t(),a==null||a()};return e.jsxs(N,{className:"border border-white/10 bg-[#121420]/80 h-full",children:[e.jsx(D,{className:"border-b border-white/10",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{className:"text-2xl text-white",children:((o=s.project)==null?void 0:o.title)||"Proyecto sin título"}),e.jsxs("p",{className:"mt-2 text-sm text-white/60",children:["ID brief: ",e.jsx("span",{className:"font-mono text-white/80",children:s.id})]})]}),e.jsx(B,{variant:"secondary",className:"bg-purple-500/20 text-purple-200",children:s.status})]})}),e.jsxs(b,{className:"space-y-5 py-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(A,{label:"Objetivo",value:s.objective}),e.jsx(A,{label:"Audiencia",value:s.audience}),e.jsx(A,{label:"Mensajes clave",value:s.key_messages}),e.jsx(A,{label:"Rango de inversión",value:s.budget_range}),e.jsx(A,{label:"Deadline",value:s.deadline_date})]}),e.jsx(R,{className:"bg-white/10"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-white/40",children:"Próximos pasos sugeridos"}),e.jsxs("div",{className:"space-y-3 text-sm text-white/75",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"h-4 w-4 text-green-400"}),"Validar viabilidad IA y complejidad técnica."]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ce,{className:"h-4 w-4 text-blue-400"}),"Estimar horas de squad y costos asociados."]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"h-4 w-4 text-orange-300"}),"Agendar discovery con el cliente si es necesario."]})]})]}),e.jsx(R,{className:"bg-white/10"}),((i=s.project)==null?void 0:i.id)&&e.jsxs(e.Fragment,{children:[e.jsx(Ve,{projectId:s.project.id,projectTitle:s.project.title||"Proyecto sin título"}),e.jsx(R,{className:"bg-white/10"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(K,{className:"h-4 w-4 text-white/60"}),e.jsxs("span",{className:"text-sm text-white/60",children:["Recibido el ",new Date(s.created_at).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-3 sm:flex-row sm:justify-end",children:[e.jsx(f,{variant:"ghost",className:"text-white/70 hover:text-white",onClick:a,children:"Cerrar"}),e.jsx(f,{variant:"outline",className:"border-accent/40 text-accent hover:bg-accent/10",onClick:()=>l("in_review"),children:"Marcar en revisión"}),e.jsx(f,{className:"bg-accent text-accent-foreground hover:bg-accent/90",onClick:()=>l("approved"),children:"Aprobar brief"})]})]})]})},W=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{className:"bg-card/40 border-border/40",children:[e.jsx(D,{children:e.jsx(M,{className:"text-2xl font-semibold text-foreground",children:"Panel del productor"})}),e.jsx(b,{className:"space-y-4 text-foreground/80",children:e.jsx("p",{children:"Aquí centralizaremos briefs entrantes, asignaciones del equipo y seguimiento de hitos. Usa las secciones laterales para revisar cada flujo mientras construimos el tablero definitivo."})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(N,{className:"bg-card/20 border-border/30",children:[e.jsx(D,{children:e.jsx(M,{className:"text-xl font-semibold text-foreground",children:"Bandeja de briefs"})}),e.jsx(b,{className:"text-foreground/70",children:"Recibirás solicitudes de clientes con validaciones IA y recomendaciones de pipeline."})]}),e.jsxs(N,{className:"bg-card/20 border-border/30",children:[e.jsx(D,{children:e.jsx(M,{className:"text-xl font-semibold text-foreground",children:"Orquestación de squad"})}),e.jsx(b,{className:"text-foreground/70",children:"Asigna especialistas, controla carga de trabajo y coordina sesiones de revisión."})]})]})]}),Ge=()=>{const[s,a]=m.useState(null),[t,n]=m.useState(0),l=()=>n(o=>o+1);return e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.1fr_0.9fr]",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"Briefs pendientes"}),e.jsxs("p",{className:"text-sm text-white/60",children:["Prioriza los briefs en estado ",e.jsx("span",{className:"text-accent",children:"submitted"}),". Cuando avances, se moverán al tablero de producción."]})]}),e.jsx(ze,{onSelectBrief:o=>a(o)},t)]}),e.jsx("div",{className:"h-full",children:s?e.jsx(We,{brief:s,onClose:()=>a(null),onRefresh:l}):e.jsx(N,{className:"border border-white/10 bg-[#121420]/60 h-full",children:e.jsxs(b,{className:"flex h-full flex-col items-center justify-center text-white/60",children:[e.jsx("p",{className:"text-lg font-semibold",children:"Selecciona un brief para ver su detalle."}),e.jsx("p",{className:"mt-2 text-sm text-white/40",children:"Aquí podrás cambiar el estado, agregar notas y coordinar la propuesta."})]})})})]})},ts=()=>e.jsxs("div",{className:"min-h-screen bg-[#05070D] text-white",children:[e.jsx("div",{className:"border-b border-white/10 bg-black/40 backdrop-blur",children:e.jsxs("div",{className:"mx-auto flex max-w-7xl items-center justify-between px-6 py-5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-white/50",children:"ILYR Producer Workspace"}),e.jsx("h1",{className:"text-2xl font-semibold text-white",children:"Operaciones y gestión de pipeline"})]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx(f,{asChild:!0,variant:"outline",className:"border-white/20 text-white hover:bg-white/10",children:e.jsx(P,{to:".",children:"Resumen"})}),e.jsx(f,{asChild:!0,variant:"outline",className:"border-white/20 text-white hover:bg-white/10",children:e.jsx(P,{to:"briefs",children:"Briefs"})}),e.jsx(f,{asChild:!0,variant:"outline",className:"border-white/20 text-white hover:bg-white/10",children:e.jsx(P,{to:"assignments",children:"Asignaciones"})}),e.jsx(he,{})]})]})}),e.jsx("main",{className:"mx-auto min-h-[calc(100vh-120px)] w-full max-w-6xl px-6 py-10 space-y-8",children:e.jsxs(oe,{children:[e.jsx(I,{index:!0,element:e.jsx(W,{})}),e.jsx(I,{path:"briefs",element:e.jsx(Ge,{})}),e.jsx(I,{path:"assignments",element:e.jsx(W,{})}),e.jsx(I,{path:"*",element:e.jsx(de,{to:".",replace:!0})})]})})]});export{ts as default};
